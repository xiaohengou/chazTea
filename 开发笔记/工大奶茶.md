# ç‘å‰å¤–å–

## ç›®å½•

-   [å¼€å‘Day1ï¼šåå°ç™»å½•åŠŸèƒ½](#å¼€å‘Day1åå°ç™»å½•åŠŸèƒ½)
    -   [çŸ¥è¯†ç‚¹1ï¼šæ³›å‹](#çŸ¥è¯†ç‚¹1æ³›å‹)
        -   [æ³›å‹çš„å‘½åçº¦å®š](#æ³›å‹çš„å‘½åçº¦å®š)
    -   [çŸ¥è¯†ç‚¹2ï¼šå‘˜å·¥ç™»å½•ä¸šåŠ¡é€»è¾‘](#çŸ¥è¯†ç‚¹2å‘˜å·¥ç™»å½•ä¸šåŠ¡é€»è¾‘)
        -   [md5åŠ å¯†](#md5åŠ å¯†)
        -   [LambdaQueryWrapper   å‚è€ƒé“¾æ¥](#LambdaQueryWrapper---å‚è€ƒé“¾æ¥)
        -   [java8 :: ï¼ˆåŒå†’å·ï¼‰ ç”¨æ³•ï¼š](#java8--åŒå†’å·-ç”¨æ³•)
    -   [çŸ¥è¯†ç‚¹3ï¼šå‘˜å·¥é€€å‡ºä¸šåŠ¡é€»è¾‘](#çŸ¥è¯†ç‚¹3å‘˜å·¥é€€å‡ºä¸šåŠ¡é€»è¾‘)
-   [å¼€å‘Day2 :](#å¼€å‘Day2-)
    -   [åŠŸèƒ½ï¼šæ·»åŠ å‘˜å·¥](#åŠŸèƒ½æ·»åŠ å‘˜å·¥)
    -   [å¼‚å¸¸å¤„ç†ï¼š](#å¼‚å¸¸å¤„ç†)
    -   [å°ç»“](#å°ç»“)
    -   [åŠŸèƒ½ï¼šå‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢](#åŠŸèƒ½å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢)
    -   [åŠŸèƒ½ï¼šå¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·](#åŠŸèƒ½å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·)
        -   [å¯¹è±¡è½¬æ¢å™¨](#å¯¹è±¡è½¬æ¢å™¨)
    -   [åŠŸèƒ½ï¼šç¼–è¾‘å‘˜å·¥ä¿¡æ¯](#åŠŸèƒ½ç¼–è¾‘å‘˜å·¥ä¿¡æ¯)
        -   [å­˜åœ¨çš„é—®é¢˜ï¼š](#å­˜åœ¨çš„é—®é¢˜)
-   [å¼€å‘Day3ï¼š](#å¼€å‘Day3)
    -   [åŠŸèƒ½ï¼šå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……](#åŠŸèƒ½å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……)
        -   [@TableFieldæ³¨è§£ä¸MetaObjectHandleæ¥å£è§£å†³è‡ªåŠ¨å¡«å……](#TableFieldæ³¨è§£ä¸MetaObjectHandleæ¥å£è§£å†³è‡ªåŠ¨å¡«å……)
        -   [ThreadLocalè§£å†³æ— æ³•è·å–Sessionçš„é—®é¢˜ï¼š](#ThreadLocalè§£å†³æ— æ³•è·å–Sessionçš„é—®é¢˜)
    -   [åŠŸèƒ½ï¼šæ–°å¢åˆ†ç±»&&åˆ†é¡µä¿¡æ¯æŸ¥è¯¢](#åŠŸèƒ½æ–°å¢åˆ†ç±»åˆ†é¡µä¿¡æ¯æŸ¥è¯¢)
    -   [åŠŸèƒ½ï¼šåˆ é™¤åˆ†ç±»](#åŠŸèƒ½åˆ é™¤åˆ†ç±»)
    -   [åŠŸèƒ½ï¼šä¿®æ”¹åˆ†ç±»](#åŠŸèƒ½ä¿®æ”¹åˆ†ç±»)
-   [å¼€å‘Day4ï¼š](#å¼€å‘Day4)
    -   [åŠŸèƒ½ï¼šæ–‡ä»¶ä¸Šä¼ ä¸‹è½½](#åŠŸèƒ½æ–‡ä»¶ä¸Šä¼ ä¸‹è½½)
    -   [åŠŸèƒ½ï¼šæ–°å¢èœå“](#åŠŸèƒ½æ–°å¢èœå“)
        -   [å¯¼å…¥DTO](#å¯¼å…¥DTO)
        -   [@Transactionalæ³¨è§£](#Transactionalæ³¨è§£)
    -   [åŠŸèƒ½ï¼šèœå“ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢](#åŠŸèƒ½èœå“ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢)
    -   [åŠŸèƒ½ï¼šä¿®æ”¹èœå“](#åŠŸèƒ½ä¿®æ”¹èœå“)
        -   [èœå“ä¿¡æ¯å›æ˜¾ï¼ˆæŸ¥è¯¢ï¼‰ï¼š](#èœå“ä¿¡æ¯å›æ˜¾æŸ¥è¯¢)
        -   [èœå“ä¿¡æ¯ä¿®æ”¹ï¼š](#èœå“ä¿¡æ¯ä¿®æ”¹)
        -   [é—®é¢˜ï¼š](#é—®é¢˜)
    -   [ä½œä¸šï¼šèœå“ï¼ˆæ‰¹é‡ï¼‰èµ·å”®/åœå”®åŠŸèƒ½](#ä½œä¸šèœå“æ‰¹é‡èµ·å”®åœå”®åŠŸèƒ½)
        -   [æ³¨è§£ï¼š@PathVariableã€@RequestParamç”¨æ³•ï¼š](#æ³¨è§£PathVariableRequestParamç”¨æ³•)
    -   [ä½œä¸šï¼šåˆ é™¤ã€æ‰¹é‡åˆ é™¤èœå“](#ä½œä¸šåˆ é™¤æ‰¹é‡åˆ é™¤èœå“)
-   [å¼€å‘Day5ï¼š](#å¼€å‘Day5)
    -   [åŠŸèƒ½ï¼šæ–°å¢å¥—é¤ï¼š](#åŠŸèƒ½æ–°å¢å¥—é¤)
    -   [åŠŸèƒ½ï¼šå¥—é¤åˆ†é¡µæŸ¥è¯¢](#åŠŸèƒ½å¥—é¤åˆ†é¡µæŸ¥è¯¢)
    -   [åŠŸèƒ½ï¼šï¼ˆæ‰¹é‡ï¼‰åˆ é™¤å¥—é¤](#åŠŸèƒ½æ‰¹é‡åˆ é™¤å¥—é¤)
    -   [åŠŸèƒ½ï¼šæ‰‹æœºéªŒè¯ç ç™»å½•](#åŠŸèƒ½æ‰‹æœºéªŒè¯ç ç™»å½•)
        -   [å‘é€éªŒè¯ç ï¼š](#å‘é€éªŒè¯ç )
        -   [ç™»å½•æ ¡éªŒ](#ç™»å½•æ ¡éªŒ)
-   [å¼€å‘Day6](#å¼€å‘Day6)
    -   [åŠŸèƒ½ï¼šå¯¼å…¥åœ°å€](#åŠŸèƒ½å¯¼å…¥åœ°å€)
        -   [ä½œä¸šï¼šè¡¥å……åŠŸèƒ½ï¼šä¿®æ”¹åœ°å€ ã€åˆ é™¤åœ°å€](#ä½œä¸šè¡¥å……åŠŸèƒ½ä¿®æ”¹åœ°å€-åˆ é™¤åœ°å€)
    -   [åŠŸèƒ½ï¼šèœå“å±•ç¤º](#åŠŸèƒ½èœå“å±•ç¤º)
    -   [åŠŸèƒ½ï¼šè´­ç‰©è½¦](#åŠŸèƒ½è´­ç‰©è½¦)
        -   [æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦](#æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦)
        -   [æŸ¥çœ‹/æ¸…ç©ºè´­ç‰©è½¦](#æŸ¥çœ‹æ¸…ç©ºè´­ç‰©è½¦)
        -   [ä½œä¸šï¼šè¡¥å……åŠŸèƒ½ï¼šå•†å“æ•°é‡-1](#ä½œä¸šè¡¥å……åŠŸèƒ½å•†å“æ•°é‡-1)
    -   [åŠŸèƒ½ï¼šç”¨æˆ·ä¸‹å•ï¼š](#åŠŸèƒ½ç”¨æˆ·ä¸‹å•)
    -   [å…·ä½“çŸ¥è¯†ç‚¹ï¼š](#å…·ä½“çŸ¥è¯†ç‚¹)
        -   [Â· AtomicInteger ï¼š](#-AtomicInteger-)
        -   [Â· IdWorker](#-IdWorker)
        -   [Â· addAndGetï¼ˆï¼‰](#-addAndGet)
        -   [Â· saveBatchï¼ˆï¼‰](#-saveBatch)

## å¼€å‘Day1ï¼šåå°ç™»å½•åŠŸèƒ½

### çŸ¥è¯†ç‚¹1ï¼šæ³›å‹

> ğŸ“Œç¬¬ä¸€æ¬¡è§æ³›å‹ç±»çš„ä½¿ç”¨ã€‚æ³›å‹åœ¨javaåŸºç¡€ä¸­ä»‹ç»è¿‡ï¼ˆæ³›å‹å¯ä»¥ä½¿ç±»å‹åœ¨å®šä¹‰ç±»ã€æ¥å£å’Œæ–¹æ³•çš„æ—¶ä¾¯æˆä¸ºå‚æ•°ï¼Œä¸æ–¹æ³•ä¸­ä½¿ç”¨çš„å½¢å‚éå¸¸ç›¸ä¼¼ï¼Œç±»å‹å‚æ•°ï¼ˆæ³›å‹ï¼‰æä¾›äº†ä¸€ç§é€šè¿‡ä¸åŒçš„è¾“å…¥è€Œé‡ç”¨ä»£ç çš„æ–¹å¼ã€‚ç±»å‹å‚æ•°å’Œå½¢å‚çš„ä¸åŒä¹‹å¤„åœ¨äºå½¢å‚è¾“å…¥çš„æ˜¯å…·ä½“çš„å€¼ï¼Œè€Œç±»å‹å‚æ•°è¾“å…¥çš„æ˜¯ç±»å‹ï¼‰ã€‚

#### æ³›å‹çš„å‘½åçº¦å®š

æŒ‰ç…§çº¦å®šï¼Œæ³›å‹çš„åç§°æ˜¯å•ä¸ªçš„å¤§å†™å­—æ¯ã€‚è¿™ä¸å˜é‡çš„å‘½åçº¦å®šå½¢æˆäº†é²œæ˜çš„å¯¹æ¯”ï¼Œå¦‚æœæ²¡æœ‰è¿™äº›çº¦å®šï¼Œå°±å¾ˆéš¾åŒºåˆ†ç±»å‹å˜é‡å’Œæ™®é€šç±»æˆ–æ¥å£å‘½åä¹‹é—´çš„åŒºåˆ«ã€‚

æ³›å‹ç±»ï¼Œç±»å‹å‚æ•°éƒ¨åˆ†ï¼Œç”¨å°–æ‹¬å·(<>)è¿›è¡Œåˆ†éš”ï¼Œå¹¶è·Ÿåœ¨ç±»ååé¢ã€‚å®ƒæŒ‡å®šçš„ç±»å‹å‚æ•°ä¸º T1ï¼ŒT2ï¼Œâ€¦ï¼Œå’Œ Tnã€‚

æ³›å‹æ–¹æ³•çš„å£°æ˜åŒ…æ‹¬ä¸€ä¸ªç±»å‹å‚æ•°é›† \<Kï¼ŒV>ï¼Œè¯¥ç±»å‹å‚æ•°é›†ä½äºå°–æ‹¬å·å†…ï¼Œå‡ºç°åœ¨æ–¹æ³•çš„è¿”å›ç±»å‹ä¹‹å‰ã€‚**å¯¹äºé™æ€æ³›å‹æ–¹æ³•ï¼Œå¼ºåˆ¶è¦æ±‚ç±»å‹å‚æ•°å¿…é¡»å‡ºç°åœ¨æ–¹æ³•çš„è¿”å›ç±»å‹ä¹‹å‰**ã€‚

```java
package com.chaz.reggie.common;
import lombok.Data;
import java.util.HashMap;
import java.util.Map;

/**
 * @author chaz
 * @time 2023-05-29 17:34:19
 * @description é€šç”¨è¿”å›ç»“æœï¼ŒæœåŠ¡ç«¯ç›¸åº”çš„æ•°æ®æœ€ç»ˆéƒ½ä¼šå°è£…æˆæ­¤å¯¹è±¡
 */

@Data
public class R<T> {

    private Integer code; //ç¼–ç ï¼š1æˆåŠŸï¼Œ0å’Œå…¶å®ƒæ•°å­—ä¸ºå¤±è´¥

    private String msg; //é”™è¯¯ä¿¡æ¯

    private T data; //æ•°æ®

    private Map map = new HashMap(); //åŠ¨æ€æ•°æ®

    public static <T> R<T> success(T object) {
        R<T> r = new R<T>();
        r.data = object;
        r.code = 1;
        return r;
    }

    public static <T> R<T> error(String msg) {
        R r = new R();
        r.msg = msg;
        r.code = 0;
        return r;
    }

    public R<T> add(String key, Object value) {
        this.map.put(key, value);
        return this;
    }
}
```

### çŸ¥è¯†ç‚¹2ï¼šå‘˜å·¥ç™»å½•ä¸šåŠ¡é€»è¾‘

#### md5åŠ å¯†

*password = DigestUtils.md5DigestAsHex(password.getBytes());*

#### LambdaQueryWrapper   [å‚è€ƒé“¾æ¥](https://blog.csdn.net/weixin_54878983/article/details/130170438?spm=1001.2101.3001.6650.2\&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EYuanLiJiHua%7EPosition-2-130170438-blog-127916392.235%5Ev36%5Epc_relevant_default_base3\&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EYuanLiJiHua%7EPosition-2-130170438-blog-127916392.235%5Ev36%5Epc_relevant_default_base3\&utm_relevant_index=3 "å‚è€ƒé“¾æ¥")

**ä¸€å¥è¯å®šä¹‰**ï¼šé€šè¿‡**è°ƒç”¨æ„é€ æ–¹æ³•**è¿”å›ä¸€ä¸ªLambdaQueryWrapperå¯¹è±¡ï¼Œåœ¨å¯¹è±¡ä¸Šä½¿ç”¨é“¾å¼ç¼–ç¨‹ã€[Lambdaè¡¨è¾¾å¼](https://so.csdn.net/so/search?q=Lambdaè¡¨è¾¾å¼\&spm=1001.2101.3001.7020 "Lambdaè¡¨è¾¾å¼")å’Œé“¾å¼è°ƒç”¨çš„æ–¹å¼ï¼Œçµæ´»åœ°**å®ç°äº†SQLæŸ¥è¯¢æ¡ä»¶æ„é€ **å’Œç®€åŒ–äº†SQLæŸ¥è¯¢ä»£ç çš„ç¼–å†™ã€‚

**ä¸€ä¸ªæµç¨‹çœ‹æ‡‚**ï¼š

**åˆ›å»º**ä¸€ä¸ªLambdaQueryWrapperå¯¹è±¡ -> ä½¿ç”¨Lambdaè¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨**æ„é€ **æŸ¥è¯¢æ¡ä»¶ -> **è°ƒç”¨**MyBatis-Plusæä¾›çš„æ–¹æ³•è·å–æŸ¥è¯¢ç»“æœã€‚

![](image/image_zjSI0HDMEY.png)

#### java8 :: ï¼ˆåŒå†’å·ï¼‰ ç”¨æ³•ï¼š

JDK8ä¸­æœ‰åŒå†’å·çš„ç”¨æ³•ï¼Œå°±æ˜¯**æŠŠæ–¹æ³•å½“åšå‚æ•°ä¼ åˆ°streamå†…éƒ¨ï¼Œä½¿streamçš„æ¯ä¸ªå…ƒç´ éƒ½ä¼ å…¥åˆ°è¯¥æ–¹æ³•é‡Œé¢æ‰§è¡Œä¸€ä¸‹**ã€‚

```java
/**
     * @description å‘˜å·¥ç™»å½•
     * @author chaz
     * @date 18:05 2023/5/29
     * @param request
     * @param employee
     * @return com.chaz.reggie.common.R<com.chaz.reggie.entity.Employee>
     */
    @PostMapping("/login")
    public R<Employee> login(HttpServletRequest request , @RequestBody Employee employee){
        //1ã€å°†é¡µé¢æäº¤çš„å¯†ç passwordè¿›è¡Œmd5åŠ å¯†å¤„ç†
        String password = employee.getPassword();
        password = DigestUtils.md5DigestAsHex(password.getBytes());

        //2ã€æ ¹æ®é¡µé¢æäº¤çš„ç”¨æˆ·åusernameæŸ¥è¯¢æ•°æ®åº“
        LambdaQueryWrapper<Employee> queryWrapper=new LambdaQueryWrapper<>();
        queryWrapper.eq(Employee::getUsername,employee.getUsername());
        Employee emp=employeeService.getOne(queryWrapper);

        //3ã€å¦‚æœæ²¡æœ‰æŸ¥è¯¢åˆ°åˆ™è¿”å›ç™»å½•å¤±è´¥ç»“æœ
        if(emp == null){
            return R.error("ç™»å½•å¤±è´¥");
        }

        //4ã€å¯†ç æ¯”å¯¹ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™è¿”å›ç™»å½•å¤±è´¥ç»“æœ
        if(!emp.getPassword().equals(password)){
            return R.error("ç™»å½•å¤±è´¥");
        }

        //5ã€æŸ¥çœ‹å‘˜å·¥çŠ¶æ€ï¼Œå¦‚æœä¸ºå·²ç¦ç”¨çŠ¶æ€ï¼Œåˆ™è¿”å›å‘˜å·¥å·²ç¦ç”¨ç»“æœ
        if(emp.getStatus() == 0){
            return R.error("è´¦å·å·²ç¦ç”¨");
        }

        //6ã€ç™»å½•æˆåŠŸï¼Œå°†å‘˜å·¥idå­˜å…¥Sess ionå¹¶è¿”å›ç™»å½•æˆåŠŸç»“æœ
        request.getSession().setAttribute("employee",emp.getId());
        return R.success(emp);
    }
```

### çŸ¥è¯†ç‚¹3ï¼šå‘˜å·¥é€€å‡ºä¸šåŠ¡é€»è¾‘

å…¶å®å°±æ˜¯åˆ é™¤sessionä¸­çš„å‘˜å·¥æ•°æ®ï¼Œ å¹¶ä¼ é€’æ¶ˆæ¯ã€‚

```java
/**
     * @description å‘˜å·¥é€€å‡º
     * @author chaz
     * @date 20:05 2023/5/29
     * @param request 
     * @return com.chaz.reggie.common.R<java.lang.String>
     */
    @PostMapping("/logout")
    public R<String> logout(HttpServletRequest request){
        request.getSession().removeAttribute("employee");
        return R.success("é€€å‡ºæˆåŠŸ");
    }
```

## å¼€å‘Day2 :

### åŠŸèƒ½ï¼šæ·»åŠ å‘˜å·¥

![](image/image_oWkCyCoMb1.png)

> ğŸ“Œæ¯”è¾ƒç®€å•çš„ä¸šåŠ¡å†™æ³•ã€‚æ¯”è¾ƒä¸ç†è§£çš„æ˜¯å…³äºæ³¨è§£çš„ä½¿ç”¨ï¼Œä»€ä¹ˆæ—¶å€™éœ€è¦åŠ æ³¨è§£ï¼Ÿ

```java
/**
     * @description æ–°å¢å‘˜å·¥
     * @author chaz
     * @date 11:41 2023/5/30
     * @param request
     * @param employee 
     * @return com.chaz.reggie.common.R<java.lang.String>
     */
    @PostMapping//è¿™é‡Œåè¾¹ä¸ç”¨å†™å…·ä½“uriæ˜¯å› ä¸ºå‰ç«¯postè¯·æ±‚ å°±æ˜¯åªåˆ°employeeï¼Œè€Œæœ¬ç±»å¼€å¤´å·²ç»å†™äº†@RequestMapping("/employee")
    public R<String> save(HttpServletRequest request,@RequestBody Employee employee){
        log.info("æ–°å¢å‘˜å·¥ï¼Œå‘˜å·¥ä¿¡æ¯ï¼š{}",employee.toString());

        //åˆå§‹å¯†ç 123456ï¼Œéœ€è¦md5åŠ å¯†
        employee.setPassword(DigestUtils.md5DigestAsHex("123456".getBytes()));

        employee.setCreateTime(LocalDateTime.now());
        employee.setUpdateTime(LocalDateTime.now());

        //è·å–å½“å‰ç”¨æˆ·id
        Long empId = (Long) request.getSession().getAttribute("employee");

        employee.setCreateUser(empId);
        employee.setUpdateUser(empId);

        employeeService.save(employee);
        return R.success("æ–°å¢å‘˜å·¥æˆåŠŸ");
    }
```

### å¼‚å¸¸å¤„ç†ï¼š

![](image/image_Fnw6F-OBMl.png)

é¦–å…ˆï¼Œåœ¨commonåŒ…ä¸­å†™å‡º **å…¨å±€å¼‚å¸¸ç±»**çš„æ¡†æ¶ï¼š

```java
/**
 * @author chaz
 * @time 2023-05-30 11:50:26
 * @description å…¨å±€å¼‚å¸¸å¤„ç†
 */
@ControllerAdvice(annotations = {RestController.class, Controller.class})
@ResponseBody
@Slf4j
public class GlobalExceptionHandler {
}
```

ç„¶åå†™ å¯¹åº”çš„ å¼‚å¸¸å¤„ç†æ–¹æ³•ï¼š

```java
/**
     * @description å¼‚å¸¸å¤„ç†æ–¹æ³•
     * @author chaz
     * @date 14:52 2023/5/30
     * @param ex 
     * @return com.chaz.reggie.common.R<java.lang.String>
     */
    @ExceptionHandler(SQLIntegrityConstraintViolationException.class)
    public R<String> exceptionHandler(SQLIntegrityConstraintViolationException ex){
        log.error(ex.getMessage());

        if (ex.getMessage().contains("Duplicate entry")){
            String[] split = ex.getMessage().split(" ");
            String msg = split[2]+"å·²å­˜åœ¨";
            return R.error(msg);
        }

        return R.error("æœªçŸ¥é”™è¯¯");
    }
```

### å°ç»“

![](image/image_svMkDJMWhE.png)

### åŠŸèƒ½ï¼šå‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢

![](image/image_Lk4Cox1uDj.png)

> ğŸ“Œåˆ†é¡µæŸ¥è¯¢è¿™é‡Œçš„å®ç°æ­¥éª¤å…¶å®å’Œä¸Šè¾¹åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯è¦å…ˆå†™ä¸€ä¸‹mybatis plusçš„é…ç½®ã€‚ç„¶åå†åˆ°controllerä¸­å†™å…·ä½“ä¸šåŠ¡åŠŸèƒ½ã€‚

é¦–å…ˆå†™MPé…ç½®ç±»ï¼š

```java
package com.chaz.reggie.config;

import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;
import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * @author chaz
 * @time 2023-05-30 17:35:57
 * @description é…ç½®MPçš„åˆ†é¡µæ’ä»¶
 */
@Configuration
public class MybatisPlusConfig {

    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor(){
        MybatisPlusInterceptor mybatisPlusInterceptor=new MybatisPlusInterceptor();
        mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor());
        return mybatisPlusInterceptor;
    }
}
```

ç„¶åå†™å‰ç«¯Getå¯¹åº”çš„ æ–¹æ³•

```java
/**
     * @description å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢
     * @author chaz
     * @date 17:40 2023/5/30
     * @param page
     * @param pageSize
     * @param name 
     * @return com.chaz.reggie.common.R<com.baomidou.mybatisplus.extension.plugins.pagination.Page>
     */
    @GetMapping("/page")
    public R<Page> page(int page,int pageSize,String name){
        log.info("page = {}, pageSize = {}, name={}",page,pageSize,name);

        //æ„é€ åˆ†é¡µæ„é€ å™¨
        Page pageInfo=new Page(page,pageSize);

        //æ„é€ æ¡ä»¶æ„é€ å™¨
        LambdaQueryWrapper<Employee> queryWrapper = new LambdaQueryWrapper();
        //æ·»åŠ è¿‡æ»¤æ¡ä»¶
        queryWrapper.like(StringUtils.isNotEmpty(name),Employee::getName,name);
        //æ·»åŠ æ’åºæ¡ä»¶
        queryWrapper.orderByDesc(Employee::getUpdateTime);

        //æ‰§è¡ŒæŸ¥è¯¢
        employeeService.page(pageInfo,queryWrapper); //æ‰§è¡Œåå¹¶ä¸éœ€è¦è¿”å›ã€‚å› ä¸ºmpå·²ç»æŠŠæ’å™éš¾é“çš„ç»“æœå°è£…åœ¨pageå¯¹è±¡ä¸­

        return R.success(pageInfo);
    }
```

### åŠŸèƒ½ï¼šå¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·

![](image/image_eac8AWfTSl.png)

![](image/image_wzOi7MwX8K.png)

äº†è§£æµç¨‹åï¼Œç¼–å†™controllerä»£ç 

```java
/**
     * @description å¯ç”¨/ç¦ç”¨å‘˜å·¥
     * @author chaz
     * @date 10:22 2023/6/2
     * @param employee
     * @return com.chaz.reggie.common.R<java.lang.String>
     */
    @PutMapping
    public R<String> update(HttpServletRequest request,@RequestBody Employee employee){
        log.info(employee.toString());

        employee.setUpdateTime(LocalDateTime.now());
        employee.setUpdateUser((Long)request.getSession().getAttribute("employee"));
        employeeService.updateById(employee);

        return R.success("å‘˜å·¥ä¿¡æ¯ä¿®æ”¹æˆåŠŸ");
    }
```

ä»£ç æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ‰§è¡Œåå¹¶ä¸ä¼šä¿®æ”¹æˆåŠŸï¼Œsqlä¼šæŠ¥é”™æ‰¾ä¸åˆ°idã€‚

åŸå› ï¼šé›ªèŠ±ç®—æ³•ç”Ÿæˆçš„idè¿‡é•¿ï¼Œå‰ç«¯å¤„ç†ä¼šç²¾åº¦ä¸¢å¤±ï¼ˆåªèƒ½16ä½ï¼‰

![](image/image_o8scBKVCqb.png)

è§£å†³åŠæ³•ï¼šå°†longè½¬ä¸ºstring

![](image/image_tbQzJPmj_Z.png)

å®ç°æ–¹æ³•æ­¥éª¤ï¼š

#### å¯¹è±¡è½¬æ¢å™¨

![](image/image_EvxSDwDSWn.png)

```java
/**
     * @description TODO the method is used to
     * @author chaz
     * @date 20:19 2023/6/2 
     * @param converters 
     */
    @Override
    protected void extendMessageConverters(List<HttpMessageConverter<?>> converters) {
        log.info("æ‰©å±•æ¶ˆæ¯è½¬æ¢å™¨.....");
        //åˆ›å»ºæ¶ˆæ¯è½¬æ¢å™¨å¯¹è±¡
        MappingJackson2HttpMessageConverter messageConverter = new MappingJackson2HttpMessageConverter();
        //è®¾ç½®å¯¹è±¡è½¬æ¢å™¨ï¼Œåº•å±‚ä½¿ç”¨Jacksonå°†Javaå¯¹è±¡è½¬ä¸ºjson
        messageConverter.setObjectMapper(new JacksonObjectMapper());
        //å°†ä¸Šé¢çš„æ¶ˆæ¯è½¬æ¢å™¨å¯¹è±¡è¿½åŠ åˆ°mvcæ¡†æ¶çš„è½¬æ¢å™¨é›†åˆä¸­
        converters.add(0,messageConverter);
    }
```

ä¿®æ”¹ä»£ç åï¼ŒåŸåŠŸèƒ½æ‰§è¡ŒæˆåŠŸã€‚

### åŠŸèƒ½ï¼šç¼–è¾‘å‘˜å·¥ä¿¡æ¯

![](image/image_U06EKvrB07.png)

å…·ä½“æ­¥éª¤ï¼š

![](image/image_mvmYleKYYu.png)

```java
/**
     * @description æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ã€‚
     * @author chaz
     * @date 19:47 2023/6/2
     * @param id 
     * @return com.chaz.reggie.common.R<com.chaz.reggie.entity.Employee>
     */
    @GetMapping("/{id}")
    public R<Employee> getById(@PathVariable Long id){
        log.info("æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯");
        Employee employee = employeeService.getById(id);
        return R.success(employee);
    }
```

#### å­˜åœ¨çš„é—®é¢˜ï¼š

1.ä¸ºä»€ä¹ˆä¸ç”¨å†™æ›´æ–°æ—¶é—´ã€ç±»ä¼¼çš„æ•°æ®ï¼Œ æ‰§è¡Œåè‡ªåŠ¨å°±æ›´æ–°æ•°æ®åº“äº†

ç­”ï¼šå› ä¸ºç›´æ¥å¤ç”¨äº†updateæ–¹æ³•ï¼Œåœ¨å‰ç«¯ä¿®æ”¹å®Œåï¼Œç›´æ¥è°ƒç”¨æ‰§è¡Œæ›´æ–°äº†ã€‚

2.restfulæ˜¯ä»€ä¹ˆï¼Ÿ

## å¼€å‘Day3ï¼š

### åŠŸèƒ½ï¼šå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……

![](image/image_hk0ETFPqbB.png)

![](image/image_AqvAexrgZu.png)

&#x20;&#x20;

#### @TableFieldæ³¨è§£ä¸MetaObjectHandleæ¥å£è§£å†³è‡ªåŠ¨å¡«å……

![](image/image_XgtHRH4jgH.png)

![](image/image_UAyCz9jf0Q.png)

#### ThreadLocalè§£å†³æ— æ³•è·å–Sessionçš„é—®é¢˜ï¼š

![](image/image_EwIEXpfEeO.png)

![](image/image_noR7brzMkN.png)

![](image/image_sPk3OX1ZJt.png)

![](image/image_WbontIbULg.png)

1.æ–°å»ºBaseContextå·¥å…·ç±»ï¼š

```java
package com.chaz.reggie.common;

/**
 * @author chaz
 * @time 2023-06-02 21:37:49
 * @description åŸºäºTreadLocalå°è£…å·¥å…·ç±»ï¼Œç”¨æˆ·ä¿å­˜å’Œè·å–å½“å‰ç™»å½•ç”¨æˆ·çš„id
 */
public class BaseContext {
    private static ThreadLocal<Long> threadLocal = new ThreadLocal<>();

    /**
     * @description è®¾ç½®å€¼
     * @author chaz
     * @date 21:45 2023/6/2
     * @param id
     */
    public static void setCurrentId(Long id){
        threadLocal.set(id);
    }

    /**
     * @description è·å–idå€¼
     * @author chaz
     * @date 21:45 2023/6/2
     * @return java.lang.Long
     */
    public static  Long getCurrentId(){
        return threadLocal.get();
    }
}

```

2.åœ¨LoginCheckFilterçš„doFilteræ–¹æ³•ä¸­è·å–å½“å‰ç”¨æˆ·id

```java
 Long empId = (Long) request.getSession().getAttribute("employee");
 BaseContext.setCurrentId(empId);
```

3\. åœ¨MyMetaObjecthandlerä¸­è°ƒç”¨å·¥å…·ç±»ï¼Œè·å–idï¼Œå¹¶å®Œæˆè‡ªåŠ¨å¡«å……ä»£ç ï¼š

```java
    metaObject.setValue("createUser",BaseContext.getCurrentId());
    metaObject.setValue("updateUser",BaseContext.getCurrentId());
```

### åŠŸèƒ½ï¼šæ–°å¢åˆ†ç±»&&åˆ†é¡µä¿¡æ¯æŸ¥è¯¢

![](image/image_emBgTaoSjX.png)

![](image/image_18EHXhf-oZ.png)

```java
@Mapper
public interface CategoryMapper extends BaseMapper<Category> {
}

public interface CategoryService extends IService<Category> {
}

@Service
public class CategoryServiceImpl extends ServiceImpl<CategoryMapper, Category> implements CategoryService {
}


```

![](image/image_dlwlomX7Tt.png)

å…·ä½“ä¸šåŠ¡ä»£ç å¦‚ä¸‹ï¼Œ å’Œä¹‹å‰çš„åŠŸèƒ½å¦‚å‡ºä¸€è¾™ã€‚  åŒ…æ‹¬ä¸‹é¢çš„åˆ†é¡µåŠŸèƒ½ä¹Ÿä¸€æ ·ã€‚

```java
/**
 * @author chaz
 * @time 2023-06-05 15:31:11
 * @description TODO
 */
@RestController
@RequestMapping("/category")
@Slf4j
public class CategoryController {

    @Autowired
    private CategoryService categoryService;

    /**
     * @description æ–°å¢åˆ†ç±»
     * @author chaz
     * @date 16:12 2023/6/5
     * @param category 
     * @return com.chaz.reggie.common.R<java.lang.String>
     */
    @PostMapping
    public R<String> save(@RequestBody Category category){
        log.info("category:{}",category);
        categoryService.save(category);
        return R.success("æ–°å¢åˆ†ç±»æˆåŠŸ");
    }

    /**
     * @description åˆ†é¡µæŸ¥è¯¢
     * @author chaz
     * @date 16:15 2023/6/5
     * @param page
     * @param pageSize 
     * @return com.chaz.reggie.common.R<com.baomidou.mybatisplus.extension.plugins.pagination.Page>
     */
    @GetMapping("/page")
    public R<Page> page(int page,int pageSize){
        //åˆ†é¡µæ„é€ å™¨
        Page<Category> pageInfo = new Page<>(page,pageSize);
        //æ¡ä»¶æ„é€ å™¨
        LambdaQueryWrapper<Category> queryWrapper = new LambdaQueryWrapper<>();
        //æ·»åŠ æ’åºæ¡ä»¶ï¼Œæ ¹æ®sortè¿›è¡Œæ’åº
        queryWrapper.orderByAsc(Category::getSort);

        //åˆ†é¡µæŸ¥è¯¢
        categoryService.page(pageInfo,queryWrapper);
        return R.success(pageInfo);
    }
}
```

### åŠŸèƒ½ï¼šåˆ é™¤åˆ†ç±»

![](image/image_S1kl1q7UFA.png)

![](image/image_-KzTYHG_9U.png)

ç®€å•å®ç°ï¼ˆç›´æ¥åˆ é™¤ï¼‰

```java
@DeleteMapping
    public R<String> delete(Long id){
        log.info("åˆ é™¤åˆ†ç±»ï¼Œidä¸ºï¼š{}" ,id);

        categoryService.removeById(id);
        return R.success("åˆ†ç±»ä¿¡æ¯åˆ é™¤æˆåŠŸ");
    }
```

ç›´æ¥åˆ é™¤æ˜¯ååˆ†ä¸åˆé€‚çš„æ–¹æ³•ï¼Œå› æ­¤è¦å®Œå–„åŠŸèƒ½

![](image/image_bdUY75BhKV.png)

ä»£ç å¦‚ä¸‹ï¼š

```java
1. å®ä½“ç±»ç›´æ¥å¯¼å…¥å³å¯
2. åˆ›å»ºmapper æ ¼å¼åŒ–ï¼Œç›´æ¥å¥—å°±è¡Œ
3. åˆ›å»ºServiceæ¥å£ï¼Œ æ ¼å¼åŒ–ï¼Œç›´æ¥å¥—
4. å®ç°ç±»


@Service
public class CategoryServiceImpl extends ServiceImpl<CategoryMapper, Category> implements CategoryService {

    @Autowired
    private DishService dishService;

    @Autowired
    private SetmealService setmealService;

    /**
     * @description æ ¹æ®idåˆ é™¤åˆ†ç±»ï¼Œåˆ é™¤å‰è¿›è¡Œåˆ¤æ–­
     * @author chaz
     * @date 17:17 2023/6/5
     * @param id
     */
    @Override
    public void remove(Long id){
        LambdaQueryWrapper<Dish> dishlambdaQueryWrapper=new LambdaQueryWrapper<>();
        //æ·»åŠ æŸ¥è¯¢æ¡ä»¶ï¼Œæ ¹æ®åˆ†ç±»idæŸ¥è¯¢
        dishlambdaQueryWrapper.eq(Dish::getCategoryId,id);
        int count=dishService.count(dishlambdaQueryWrapper);

        //æŸ¥è¯¢å½“å‰ åˆ†ç±»æ˜¯å¦æœ‰å…³è”çš„èœå“ï¼Œå¦‚æœå…³è”ï¼ŒæŠ›å‡ºå¼‚å¸¸
        if (count>0) {
            //å·²ç»å…³è”èœå“ï¼Œéœ€è¦æŠ›å‡ºå¼‚å¸¸
            throw new CustomException("å½“å‰åˆ†ç±»ä¸‹å…³è”äº†èœå“ï¼Œä¸èƒ½åˆ é™¤");
        }

        //æŸ¥è¯¢å½“å‰ åˆ†ç±»æ˜¯å¦æœ‰å…³è”çš„å¥—é¤ï¼Œå¦‚æœå…³è”ï¼ŒæŠ›å‡ºå¼‚å¸¸
        LambdaQueryWrapper<Setmeal> setmealLambdaQueryWrapper = new LambdaQueryWrapper<>();
        //æ·»åŠ æŸ¥è¯¢æ¡ä»¶ï¼Œæ ¹æ®åˆ†ç±»idæŸ¥è¯¢
        setmealLambdaQueryWrapper.eq(Setmeal::getCategoryId,id);
        int count2=setmealService.count(setmealLambdaQueryWrapper);
        if (count2>0){
            //å·²ç»å…³è”å¥—é¤ï¼Œéœ€è¦æŠ›å‡ºå¼‚å¸¸
            throw new CustomException("å½“å‰åˆ†ç±»ä¸‹å…³è”äº†å¥—é¤ï¼Œä¸èƒ½åˆ é™¤");
        }

        //éƒ½æ²¡æœ‰ï¼Œæ­£å¸¸åˆ é™¤åˆ†ç±»
        super.removeById(id);
    }
}

è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼š
/**
 * @author chaz
 * @time 2023-06-05 19:16:31
 * @description è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»
 */
public class CustomException extends RuntimeException{
    public CustomException(String message){
        super(message);
    }
}

å¼‚å¸¸å¤„ç†æ–¹æ³•ï¼š
/**
     * @description å¼‚å¸¸å¤„ç†æ–¹æ³•--åˆ é™¤åˆ†ç±»
     * @author chaz
     * @date 14:52 2023/5/30
     * @param ex
     * @return com.chaz.reggie.common.R<java.lang.String>
     */
    @ExceptionHandler(CustomException.class)
    public R<String> exceptionHandler(CustomException ex){
        log.error(ex.getMessage());

        return R.error(ex.getMessage());
    }

```

### åŠŸèƒ½ï¼šä¿®æ”¹åˆ†ç±»

è€ç”Ÿå¸¸è°ˆï¼Œè¿‡äºç®€å•ï¼Œç›´æ¥æ”¾ä»£ç ï¼š

```java
/**
     * @description æ ¹æ®idæ›´æ–°åˆ†ç±»ä¿¡æ¯
     * @author chaz
     * @date 20:02 2023/6/5
     * @param category
     * @return com.chaz.reggie.common.R<java.lang.String>
     */
    @PutMapping
    public R<String> update(@RequestBody Category category){
        log.info("ä¿®æ”¹åˆ†ç±»ä¿¡æ¯ï¼š{}",category);

        categoryService.updateById(category);

        return R.success("ä¿®æ”¹åˆ†ç±»ä¿¡æ¯æˆåŠŸ");
    }
```

## å¼€å‘Day4ï¼š

### åŠŸèƒ½ï¼šæ–‡ä»¶ä¸Šä¼ ä¸‹è½½

![](image/image_z6DHvg3KZY.png)

![](image/image_Uvyqg5j_NZ.png)

æœåŠ¡ç«¯ï¼š

![](image/image_SHNZNcT0-I.png)

![](image/image_JjPzOJLT89.png)

æ–‡ä»¶ä¸Šä¼ å®ç°ï¼š

```java
/**
 * @author chaz
 * @time 2023-06-05 20:40:56
 * @description TODO
 */

@RestController
@RequestMapping("/common")
@Slf4j
public class CommonController {

    @Value("${reggie.path}")
    private String basePath;

    /**
     * @description æ–‡ä»¶ä¸Šä¼ 
     * @author chaz
     * @date 20:43 2023/6/5
     * @param file 
     * @return com.chaz.reggie.common.R<java.lang.String>
     */
    @PostMapping("/upload")
    public R<String> upload(MultipartFile file){ //æ­¤å¤„å½¢å‚åç§°ä¸èƒ½éšæ„å‘½åï¼Œå¿…é¡»è¦å’Œ å‰ç«¯è¯·æ±‚è¡¨å•ä¸­çš„name=â€œfileâ€ çš„nameä¸€è‡´
        log.info(file.toString());
        //åŸå§‹æ–‡ä»¶å
        String originalFileName=file.getOriginalFilename();
        String suffix = originalFileName.substring(originalFileName.lastIndexOf("."));

        //ä½¿ç”¨UUIDé‡æ–°ç”Ÿæˆæ–‡ä»¶åï¼Œé˜²æ­¢æ–‡ä»¶é‡åå¯¼è‡´çš„æ–‡ä»¶è¦†ç›–
        String fileName = UUID.randomUUID().toString()+suffix;

        //åˆ›å»ºä¸€ä¸ªç›®å½•
        File dir= new File(basePath);
        if (!dir.exists()) {
            //ç›®å½•ä¸å­˜åœ¨æ—¶åˆ›å»ºç›®å½•
            dir.mkdirs();
        }

        try {
            file.transferTo(new File(basePath+fileName));
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
        return R.success(fileName);
    }
}
```

æ–‡ä»¶ä¸‹è½½ï¼šå‰ç«¯å‘é€è¯·æ±‚ï¼Œåç«¯é€šè¿‡è¾“å…¥è¾“å‡ºæµ å¤„ç†

![](image/image_4FaIHj1RU6.png)

```java
@GetMapping("/download")
    public void download(String name, HttpServletResponse response){

        try {
            //è¾“å…¥æµï¼Œé€šè¿‡è¾“å…¥æµè¯»å–æ–‡ä»¶å†…å®¹
            FileInputStream fileInputStream = new FileInputStream(new File(basePath+name));
            //è¾“å‡ºæµï¼Œé€šè¿‡è¾“å‡ºæµå°†æ–‡ä»¶å†™ä¼šæµè§ˆå™¨ï¼Œåœ¨æµè§ˆå™¨æ˜¾ç¤ºå›¾ç‰‡
            ServletOutputStream outputStream=response.getOutputStream();

            response.setContentType("image/jpeg");

            int len=0;
            byte[] bytes = new byte[1024];
            while((len = fileInputStream.read(bytes)) != -1){
                outputStream.write(bytes,0,len);
                outputStream.flush();
            }

            //å…³é—­èµ„æº
            outputStream.close();
            fileInputStream.close();
        } catch (Exception e) {
            e.printStackTrace();
        }


    }
```

### åŠŸèƒ½ï¼šæ–°å¢èœå“

å‡†å¤‡å·¥ä½œï¼šæ­æ¡†æ¶

![](image/image_FsdLt4JMrB.png)

![](image/image_KQvfaOuMes.png)

1.èœå“åˆ†ç±»ä¸‹æ‹‰æ¡†å®ç°

```java
/**
     * @description æ ¹æ®æ¡ä»¶æŸ¥è¯¢åˆ†ç±»æ•°æ®
     * @author chaz
     * @date 10:21 2023/6/6 
     * @param category 
     * @return com.chaz.reggie.common.R<java.util.List<com.chaz.reggie.entity.Category>>
     */
    @GetMapping("/list")
    public R<List<Category>> list(Category category){
        //æ¡ä»¶æ„é€ å™¨
        LambdaQueryWrapper<Category> queryWrapper=new LambdaQueryWrapper<>();
        //æ·»åŠ æ¡ä»¶
        queryWrapper.eq(category.getType()!=null,Category::getType,category.getType());
        //æ·»åŠ æ’åºæ¡ä»¶
        queryWrapper.orderByAsc(Category::getSort).orderByAsc(Category::getUpdateTime);

        List<Category> list = categoryService.list(queryWrapper);
        return R.success(list);
    }
```

2.ä»å‰ç«¯è·å–dishã€dishflavoræ•°æ®ï¼š

![](image/image_aC3EVwhSQo.png)

å‰ç«¯ä¼ æ¥çš„æ•°æ®è¾ƒä¸ºå¤æ‚ï¼Œæ²¡æœ‰å¯¹åº”çš„å®ä½“ç±»ï¼ˆDishä¸­æ²¡æœ‰flavorçš„æ•°æ®ï¼‰ï¼Œå› æ­¤éœ€è¦å¼•å…¥**DTO**

#### å¯¼å…¥DTO

![](image/image_KeVjPzVD4T.png)

3.å¯¼å…¥dtoåï¼Œå¯ä»¥å¼€å§‹å†™å…·ä½“çš„Serviceä»£ç ï¼š

```java
@Autowired
    private DishFlavorService dishFlavorService;

    /**
     * @description æ–°å¢èœå“åŒæ—¶ä¿å­˜å¯¹äºçš„å£å‘³æ•°æ®
     * @author chaz
     * @date 10:48 2023/6/6
     * @param dishDto
     */
    @Override
    @Transactional
    public void saveWithFlavor(DishDto dishDto) {
        //ä¿å­˜èœå“çš„åŸºæœ¬ä¿¡æ¯åˆ°èœå“è¡¨dish
        this.save(dishDto);

        Long dishId=dishDto.getId();//è·å–èœå“id
        //èœå“å£å‘³
        List<DishFlavor> flavors=dishDto.getFlavors();
        //å°†dishidèµ‹å€¼ç»™æ¯ä¸€ä¸ªDsihFlavor  ï¼ˆ.stream()æ˜¯å°†é›†åˆè½¬åŒ–ä¸ºæµ,.mapæ˜¯å°†æµä¸­çš„å…ƒç´ è®¡ç®—æˆ–è€…è½¬æ¢(æ­¤å¤„ç”¨mapä¸ºæµä¸­çš„dishidèµ‹å€¼),.collectæ˜¯å°†æµè½¬ä¸ºé›†åˆï¼‰
        flavors = flavors.stream().map((item)->{
            item.setDishId(dishId);
            return item;
        }).collect(Collectors.toList());

        //ä¿å­˜èœå“å£å‘³æ•°æ®åˆ°èœå“å£å‘³è¡¨dish_flavor
//        dishFlavorService.saveBatch(dishDto.getFlavors()); è¿™æ ·å†™æœ‰é—®é¢˜ï¼Œå› ä¸ºç›´æ¥getFlavors()ä¸­çš„æ•°æ®æ²¡æœ‰dishid
        dishFlavorService.saveBatch(flavors);
    }
  
 //Controllerå±‚æ¯”è¾ƒç®€å•ï¼š
 @PostMapping
    public R<String> save(@RequestBody DishDto dishDto){
        log.info(dishDto.toString());

        dishService.saveWithFlavor(dishDto);
        return R.success("æ–°å¢èœå“æˆåŠŸ");
    }   
```

#### @**Transactional**æ³¨è§£

äº‹åŠ¡æ§åˆ¶ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§

`@Transactional`æ˜¯springä¸­å£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„æ³¨è§£é…ç½®æ–¹å¼ï¼Œç›¸ä¿¡è¿™ä¸ªæ³¨è§£çš„ä½œç”¨å¤§å®¶éƒ½å¾ˆæ¸…æ¥šã€‚`@Transactional`æ³¨è§£å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠäº‹åŠ¡å¼€å¯ã€æäº¤æˆ–è€…å›æ»šçš„æ“ä½œï¼Œé€šè¿‡aopçš„æ–¹å¼è¿›è¡Œç®¡ç†ã€‚

é€šè¿‡`@Transactional`æ³¨è§£å°±èƒ½è®©springä¸ºæˆ‘ä»¬ç®¡ç†äº‹åŠ¡ï¼Œå…å»äº†é‡å¤çš„äº‹åŠ¡ç®¡ç†é€»è¾‘ï¼Œå‡å°‘å¯¹ä¸šåŠ¡ä»£ç çš„ä¾µå…¥ï¼Œä½¿æˆ‘ä»¬å¼€å‘äººå‘˜èƒ½å¤Ÿä¸“æ³¨äºä¸šåŠ¡å±‚é¢å¼€å‘ã€‚

***@EnableTransactionManagement***

### åŠŸèƒ½ï¼šèœå“ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢

![](image/image_SZpqLo_-Dw.png)

ä¼ ç»Ÿå†™æ³•ï¼š

```java
@GetMapping("/page")
    public R<Page> page(int page,int pageSize,String name){

        //æ„é€ åˆ†é¡µæ„é€ å™¨å¯¹è±¡
        Page<Dish> pageInfo = new Page<>(page,pageSize);

        //æ¡ä»¶æ„é€ å™¨
        LambdaQueryWrapper<Dish> queryWrapper = new LambdaQueryWrapper<>();
        //æ·»åŠ è¿‡æ»¤æ¡ä»¶
        queryWrapper.like(name != null,Dish::getName,name);
        //æ·»åŠ æ’åºæ¡ä»¶
        queryWrapper.orderByDesc(Dish::getUpdateTime);

        //æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢
        dishService.page(pageInfo,queryWrapper);

        return R.success(pageInfo);
    }
```

è¯¥æ–¹æ³•å¹¶ä¸ç¬¦åˆè¦æ±‚ï¼Œå› ä¸ºè¿”å›çš„æ˜¯categoryid  è€Œä¸æ˜¯categoryname å› æ­¤å‰ç«¯æ˜¾ç¤ºä¸å‡ºæ¥åˆ†ç±»åç§°categorynameã€‚

å¯ä»¥é€šè¿‡åˆ†é¡µå¯¹è±¡ï¼Œæ”¹å˜å…¶ä¸­çš„å†…å®¹æ¥è¾¾åˆ°å±•ç¤º categorynameçš„ç›®æ ‡ï¼š

```java
@GetMapping("/page")
    public R<Page> page(int page,int pageSize,String name){

        //æ„é€ åˆ†é¡µæ„é€ å™¨å¯¹è±¡
        Page<Dish> pageInfo = new Page<>(page,pageSize);
        Page<DishDto> dishDtoPage=new Page<>();

        //æ¡ä»¶æ„é€ å™¨
        LambdaQueryWrapper<Dish> queryWrapper = new LambdaQueryWrapper<>();
        //æ·»åŠ è¿‡æ»¤æ¡ä»¶
        queryWrapper.like(name != null,Dish::getName,name);
        //æ·»åŠ æ’åºæ¡ä»¶
        queryWrapper.orderByDesc(Dish::getUpdateTime);

        //æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢
        dishService.page(pageInfo,queryWrapper);

        BeanUtils.copyProperties(pageInfo,dishDtoPage,"records");

        List<Dish> records = pageInfo.getRecords();

        List<DishDto> list = records.stream().map((item) -> {
            DishDto dishDto = new DishDto();

            BeanUtils.copyProperties(item,dishDto);

            Long categoryId = item.getCategoryId();//åˆ†ç±»id
            //æ ¹æ®idæŸ¥è¯¢åˆ†ç±»å¯¹è±¡
            Category category = categoryService.getById(categoryId);

            if(category != null){
                String categoryName = category.getName();
                dishDto.setCategoryName(categoryName);
            }
            return dishDto;
        }).collect(Collectors.toList());

        dishDtoPage.setRecords(list);

        return R.success(dishDtoPage);
    }
```

### åŠŸèƒ½ï¼šä¿®æ”¹èœå“

&#x20;

![](image/image_1_AJZBHYOq.png)

#### èœå“ä¿¡æ¯å›æ˜¾ï¼ˆæŸ¥è¯¢ï¼‰ï¼š

Controllerå±‚ï¼š

```java

/**
     * @description æ ¹æ®idæ›´æ–°åˆ†ç±»ä¿¡æ¯
     * @author chaz
     * @date 20:02 2023/6/5
     * @param category
     * @return com.chaz.reggie.common.R<java.lang.String>
     */
    @PutMapping
    public R<String> update(@RequestBody Category category){
        log.info("ä¿®æ”¹åˆ†ç±»ä¿¡æ¯ï¼š{}",category);

        categoryService.updateById(category);

        return R.success("ä¿®æ”¹åˆ†ç±»ä¿¡æ¯æˆåŠŸ");
    }
```

Serviceå±‚ï¼š

```java
/**
     * @description æ ¹æ®idæŸ¥è¯¢èœå“ä¿¡æ¯å’Œå¯¹åº”çš„å£å‘³ä¿¡æ¯
     * @author chaz
     * @date 10:24 2023/6/8
     * @param id
     * @return com.chaz.reggie.dto.DishDto
     */
    @Override
    public DishDto getByIdWithFlavor(Long id) {
        //æŸ¥è¯¢èœå“åŸºæœ¬ä¿¡æ¯ï¼Œä»dishè¡¨æŸ¥è¯¢
        Dish dish = this.getById(id);

        DishDto dishDto=new DishDto();
        BeanUtils.copyProperties(dish,dishDto);

        //æŸ¥è¯¢å½“å‰èœå“å¯¹åº”é¢åº¦å£å‘³ä¿¡æ¯ï¼Œä»dish_flavorè¡¨æŸ¥è¯¢
        LambdaQueryWrapper<DishFlavor> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.eq(DishFlavor::getDishId,dish.getId());
        List<DishFlavor> flavors = dishFlavorService.list(queryWrapper);
        dishDto.setFlavors(flavors);

        return dishDto;
    }
```

#### èœå“ä¿¡æ¯ä¿®æ”¹ï¼š

Controllerï¼š

```java
/**
     * @description ä¿®æ”¹èœå“ä¿¡æ¯
     * @author chaz
     * @date 10:40 2023/6/8
     * @param dishDto
     * @return com.chaz.reggie.common.R<java.lang.String>
     */
    @PutMapping
    public R<String> update(@RequestBody DishDto dishDto){
        log.info(dishDto.toString());

        dishService.updateWithFlavor(dishDto);

        return R.success("ä¿®æ”¹èœå“æˆåŠŸ");
    }
```

Serviceå±‚ï¼š

```java
/**
     * @description æ›´æ–°èœå“ä¿¡æ¯ï¼ŒåŒæ—¶æ›´æ–°å£å‘³ä¿¡æ¯
     * @author chaz
     * @date 10:41 2023/6/8
     * @param dishDto
     */
    @Override
    public void updateWithFlavor(DishDto dishDto) {
        //æ›´æ–°dishè¡¨åŸºæœ¬ä¿¡æ¯
        this.updateById(dishDto);

        //æ¸…ç†æˆ¿å‰èœå“å¯¹åº”å£å‘³æ•°æ®--dish_flavorè¡¨çš„deleteæ“ä½œ
        LambdaQueryWrapper<DishFlavor> queryWrapper=new LambdaQueryWrapper<>();
        queryWrapper.eq(DishFlavor::getDishId,dishDto.getId());
        dishFlavorService.remove(queryWrapper);

        //æ·»åŠ å½“å‰æäº¤è¿‡æ¥çš„å£å‘³æ•°æ®--dish_flavorè¡¨çš„insertæ“ä½œ
        List<DishFlavor> flavors = dishDto.getFlavors();
        flavors = flavors.stream().map((item)->{
            item.setDishId(dishDto.getId());
            return item;
        }).collect(Collectors.toList());

        dishFlavorService.saveBatch(flavors);
    }
```

#### é—®é¢˜ï¼š

è¿™é‡Œå…¶å®æœ‰ä¸€ä¸ªå°bugï¼Œå°±æ˜¯åˆ é™¤flavor è¡¨ä¸­çš„å£å‘³æ•°æ®ï¼Œä¼šæŠŠåˆ›å»ºæ—¶é—´ä¹Ÿç»™åˆ é™¤äº†ï¼Œå†æ·»åŠ çš„æ—¶å€™ä¹Ÿå°±æ— æ³•è·å–åˆ é™¤æ—¶é—´ï¼Œè€Œæ˜¯ç›´æ¥åˆ›å»ºæ–°ä¸€æ¡æ•°æ®ï¼Œå› æ­¤å…¶å®å¦‚æœå£å‘³æ•°æ®æ²¡æ”¹çš„è¯ï¼Œæ˜¯è¢«è«åå…¶å¦™ä¿®æ”¹äº†åˆ›å»ºæ—¶é—´çš„ã€‚ ä½†æ˜¯å‰ç«¯ç”¨æˆ·çœ‹ä¸åˆ°ï¼Œä¸å½±å“ä½¿ç”¨ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºæ˜¯æœ‰é—®é¢˜çš„ã€‚

### ä½œä¸šï¼šèœå“ï¼ˆæ‰¹é‡ï¼‰èµ·å”®/åœå”®åŠŸèƒ½

å‰ç«¯è¯·æ±‚å¦‚ä¸‹ï¼š

![](image/image_eS1CQg5UEP.png)

èµ·å”®ã€åœå”® ä»¥åŠæ‰¹é‡èµ·å”®ã€åœå”® ç”¨çš„æ˜¯åŒä¸€ä¸ªæ–¹æ³•ã€‚ å› æ­¤åªéœ€è¦æŒ‰ç…§æ‰¹é‡çš„æ¥ ç¼–å†™ä»£ç å³å¯ã€‚ è¿˜æ˜¯è€å¥—è·¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ³¨è§£çš„ç›¸å…³é—®é¢˜ã€‚

```java
/**
     * @description èµ·å”®ã€åœå”®ä»¥åŠ æ‰¹é‡èµ·å”®ã€åœå”®
     * @author chaz
     * @date 17:53 2023/6/8
     * @param status
     * @param id
     * @return com.chaz.reggie.common.R<java.lang.String>
     */
    @PostMapping("/status/{status}")
    public R<String> status(@PathVariable Integer status, @RequestParam Long[] id){
        log.info("å½“å‰çŠ¶æ€ï¼š{}ï¼Œå½“å‰idï¼š{}",status,id);

        for(int i=0;i<id.length;i++)
        {
            Dish dish = dishService.getById(id[i]);
            if (dish!=null){
                dish.setStatus(status);
                dishService.updateById(dish);
            }
        }
        return R.success("å•†å“çŠ¶æ€ä¿®æ”¹æˆåŠŸ");
    }
    
        //æ›´å¥½ä¸€ç‚¹çš„å†™æ³•
@PostMapping("/status/{status}")
public Result<String> status(@PathVariable Integer status, @RequestParam List<Long> ids) {
    log.info("status:{},ids:{}", status, ids);
    LambdaUpdateWrapper<Dish> updateWrapper = new LambdaUpdateWrapper<>();
    updateWrapper.in(ids != null, Dish::getId, ids);
    updateWrapper.set(Dish::getStatus, status);
    dishService.update(updateWrapper);
    return Result.success("æ‰¹é‡æ“ä½œæˆåŠŸ");
}
```

#### æ³¨è§£ï¼š**@PathVariable**ã€**@RequestParam**ç”¨æ³•ï¼š

### ä½œä¸šï¼šåˆ é™¤ã€æ‰¹é‡åˆ é™¤èœå“

![](image/image_dwKms4gyqn.png)

åˆ é™¤è¿™é‡Œæ¶‰åŠä¸€ä¸ªçœŸå‡åˆ é™¤çš„é—®é¢˜ï¼ŒæŒ‰ç†è¯´åº”è¯¥æ˜¯é€»è¾‘åˆ é™¤ï¼Œä½†æ˜¯å› ä¸ºå‰è¾¹çš„å¾ˆå¤šé¡µé¢å±•ç¤ºéƒ½æ²¡æœ‰è€ƒè™‘isdeleteå­—æ®µï¼Œå› æ­¤è¿™é‡Œå·æ‡’ç›´æ¥çœŸåˆ é™¤äº†ã€‚ä»£ç å¦‚ä¸‹

```java
@DeleteMapping
    public R<String> delete(@RequestParam Long[] id){
        log.info("åˆ é™¤èœå“ï¼Œidä¸ºï¼š{}" ,id);

        //å‡åˆ é™¤ï¼Œé—®é¢˜ï¼šå‰ç«¯ä¾æ—§æ˜¾ç¤º
//        //æ ¹æ®idæ‹¿åˆ° dishDtoå¯¹è±¡
//        DishDto dishDto = dishService.getByIdWithFlavor(id);
//        dishDto.setIsDeleted(1);
//        dishService.updateById(dishDto);

        //çœŸåˆ é™¤ï¼Œé—®é¢˜ï¼šçœŸåˆ é™¤çš„è¯isdeleteæœ‰å•¥ç”¨ï¼Ÿ
        for(long i : id){
            dishService.removeById(i);
        }
        return R.success("èœå“åˆ é™¤æˆåŠŸ");
    }

```

è¿™æ ·å…¶å®ä¹Ÿè¿˜æ˜¯ä¸åˆç†ï¼Œå› ä¸ºåœ¨å”®çŠ¶æ€çš„èœå“ä¸åº”è¯¥èƒ½åˆ é™¤ï¼Œå› æ­¤æœ‰ä¸‹é¢æ›´åˆé€‚çš„ä»£ç ï¼š

```java
@DeleteMapping
    public R<String> delete(@RequestParam Long[] id){
        log.info("åˆ é™¤èœå“ï¼Œidä¸ºï¼š{}" ,id);

        LambdaQueryWrapper<Dish> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.in(Dish::getId, id);
        List<Dish> dishes = dishService.list(queryWrapper);
        for (Dish dish : dishes) {
            if (dish.getStatus() == 1) {
                throw new CustomException("åˆ é™¤åˆ—è¡¨ä¸­å­˜åœ¨å¯å”®çŠ¶æ€å•†å“ï¼Œæ— æ³•åˆ é™¤");
            }
        }
        dishService.remove(queryWrapper);
        return R.success("åˆ é™¤æˆåŠŸ");
    }
```

## å¼€å‘Day5ï¼š

### åŠŸèƒ½ï¼šæ–°å¢å¥—é¤ï¼š

![](image/image_8NoGbdFx37.png)

è€æµç¨‹ï¼Œæ­å»ºæ¡†æ¶ï¼Œä»£ç ç•¥ï¼›

![](image/image_Viovt8i2u3.png)

&#x20;1.å’Œ2. å¤ç”¨äº†å‰è¾¹çš„ä»£ç 

1.  å±•ç¤ºèœå“åˆ†ç±»æ•°æ®ï¼š

![](image/image_uAcDhbIaS6.png)

å®ç°ä»£ç æ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬çš„æŸ¥è¯¢æ“ä½œï¼š

```java
@GetMapping("/list")
    public R<List<Dish>> list(Dish dish){

        //æ„é€ æŸ¥è¯¢æ¡ä»¶
        LambdaQueryWrapper<Dish> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.eq(dish.getCategoryId()!=null,Dish::getCategoryId, dish.getCategoryId());
        //åªæŸ¥åœ¨å”®çš„ï¼Œè¿‡æ»¤æ‰åœå”®çš„ï¼ˆçŠ¶æ€ä¸º0çš„ï¼‰
        queryWrapper.eq(Dish::getStatus,1);

        //æ·»åŠ æ’åºæ¡ä»¶
        queryWrapper.orderByAsc(Dish::getSort).orderByAsc(Dish::getUpdateTime);

        List<Dish> list = dishService.list(queryWrapper);

        return R.success(list);
    }
```

4 5 åœ¨å‰é¢å·²ç»å®ç°è¿‡äº†

1.  Serviceå±‚ï¼š

```java
@Override
    public void saveWithDish(SetmealDto setmealDto) {
        //ä¿å­˜å¥—é¤çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ“ä½œsetmealï¼Œæ‰§è¡Œinsertæ“ä½œ
        this.save(setmealDto);

        List<SetmealDish> setmealDishes = setmealDto.getSetmealDishes();
        setmealDishes.stream().map((item) ->{
            item.setSetmealId(setmealDto.getId());
            return item;
        }).collect(Collectors.toList());

        //ä¿å­˜å¥—é¤å’Œèœå“çš„å…³è”ä¿¡æ¯ï¼Œæ“ä½œsetmeal_dishï¼Œæ‰§è¡Œinsertæ“ä½œ
        setmealDishService.saveBatch(setmealDishes);
    }
```

Controlleå±‚ï¼š

```java
@PostMapping
    public R<String> save(@RequestBody SetmealDto setmealDto){
        log.info("å¥—é¤ä¿¡æ¯ï¼š{}",setmealDto);

        setmealService.saveWithDish(setmealDto);

        return R.success("æ–°å¢å¥—é¤æˆåŠŸ");
    }

```

### åŠŸèƒ½ï¼šå¥—é¤åˆ†é¡µæŸ¥è¯¢

![](image/image_wWLtDEXJc9.png)

æœ¬éƒ¨åˆ†å’Œday4çš„åˆ†é¡µæŸ¥è¯¢ åŸºæœ¬ä¸€æ¨¡ä¸€æ ·ï¼š

```java
@GetMapping("/page")
    public R<Page> page(int page,int pageSize,String name){
        //åˆ†é¡µæ„é€ å™¨
        Page<Setmeal> pageInfo = new Page<>(page,pageSize);
        Page<SetmealDto> dtoPage=new Page<>();

        LambdaQueryWrapper<Setmeal> queryWrapper = new LambdaQueryWrapper<>();
        //æ·»åŠ æŸ¥è¯¢æ¡ä»¶ï¼Œæ ¹æ®nameè¿›è¡Œlikeæ¨¡ç³ŠæŸ¥è¯¢
        queryWrapper.like(name!=null,Setmeal::getName,name);
        //æ·»åŠ æ’åºæ¡ä»¶ï¼Œæ ¹æ®æ›´æ–°æ—¶é—´é™åºæ’åˆ—
        queryWrapper.orderByDesc(Setmeal::getUpdateTime);

        setmealService.page(pageInfo,queryWrapper);

        //å¯¹è±¡æ‹·è´
        BeanUtils.copyProperties(pageInfo,dtoPage,"records");
        List<Setmeal> records=pageInfo.getRecords();

        List<SetmealDto> list = records.stream().map((item)->{
            SetmealDto setmealDto = new SetmealDto();
            //å¯¹è±¡æ‹·è´
            BeanUtils.copyProperties(item,setmealDto);
            //åˆ†ç±»id
            Long categoryId=item.getCategoryId();
            //æ ¹æ®åˆ†ç±»idæŸ¥è¯¢åˆ†ç±»å¯¹è±¡
            Category category = categoryService.getById(categoryId);
            if (category!=null){
                //åˆ†ç±»åç§°
                String categoryName = category.getName();
                setmealDto.setCategoryName(categoryName);
            }
            return setmealDto;
        }).collect(Collectors.toList());

        dtoPage.setRecords(list);
        return R.success(dtoPage);
    }
```

### åŠŸèƒ½ï¼šï¼ˆæ‰¹é‡ï¼‰åˆ é™¤å¥—é¤

![](image/image_tzPlQywIjy.png)

åŸºæœ¬ä¹Ÿæ˜¯è€ç”Ÿå¸¸è°ˆçš„å†…å®¹ï¼Œåªéœ€è¦æ³¨æ„åˆ é™¤æ—¶å€™è¦æŠŠ å¥—é¤å’Œèœå“çš„å…³è”ä¿¡æ¯ä¹ŸåŒæ—¶åˆ é™¤äº†ã€‚

Serviceå±‚ï¼š

```java
@Transactional
    @Override
    public void removeWithDish(List<Long> ids) {
        //select count(*) from setmeal where id in (1,2,3) and status = 1
        //æŸ¥è¯¢å¥—é¤çŠ¶æ€ï¼Œç¼ºç‚¹æ˜¯å¦å¯ä»¥åˆ é™¤
        LambdaQueryWrapper<Setmeal> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.in(Setmeal::getId,ids);
        queryWrapper.eq(Setmeal::getStatus,1);

        int count = this.count(queryWrapper);
        if ((count)>0){
            //å¦‚æœä¸èƒ½åˆ é™¤ï¼ŒæŠ›å‡ºä¸šåŠ¡å¼‚å¸¸
            throw new CustomException("å¥—é¤æ­£åœ¨å”®å–ä¸­ï¼Œä¸èƒ½åˆ é™¤");
        }

        //å¦‚æœå¯ä»¥åˆ é™¤ï¼Œå…ˆåˆ é™¤å¥—é¤è¡¨ä¸­çš„æ•°æ®--setmeal
        this.removeByIds(ids);

        //delete from setmeal_dish where setmeal_id in (1,2,3)
        LambdaQueryWrapper<SetmealDish> lambdaQueryWrapper = new LambdaQueryWrapper<>();
        lambdaQueryWrapper.in(SetmealDish::getSetmealId,ids);
        //åˆ é™¤å…³ç³»è¡¨ä¸­çš„æ•°æ®--setmeal_dish
        setmealDishService.remove(lambdaQueryWrapper);
    }
```

controllerå±‚ï¼š

```java
public R<String> delete(@RequestParam List<Long> ids){
        log.info("åˆ é™¤èœå“ï¼Œidä¸ºï¼š{}" ,ids);
        setmealService.removeWithDish(ids);
        return R.success("å¥—é¤æ•°æ®åˆ é™¤æˆåŠŸ");
    }
```

### åŠŸèƒ½ï¼šæ‰‹æœºéªŒè¯ç ç™»å½•

![](image/image_Lk0XXDt1lk.png)

![](image/image_slbgfgt4ZC.png)

å’Œå‰è¾¹ä¸€æ ·ï¼Œæœºæ¢°æ€§çš„æ­å»ºæ¡†æ¶ã€‚

#### å‘é€éªŒè¯ç ï¼š

![](image/image_Yh1XmpTyep.png)

åç«¯ç”ŸæˆéªŒè¯ç ï¼Œç„¶åç”¨é˜¿é‡Œäº‘æœåŠ¡å‘é€è¯¥éªŒè¯ç åˆ°æ‰‹æœºï¼Œå®¢æˆ·è·å–éªŒè¯ç åè¾“å…¥ã€‚

```java
@PostMapping("/sendMsg")
    public R<String> sendMsg(@RequestBody User user, HttpSession session){
        //è·å–æ‰‹æœºå·
        String phone=user.getPhone();

        if (StringUtils.isNotEmpty(phone)){
            //ç”Ÿæˆéšæœº4ä½éªŒè¯ç 
            String code = ValidateCodeUtils.generateValidateCode(4).toString();
            log.info("phone={} , code={}",phone,code);

            //è°ƒç”¨é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡apiå®Œæˆå‘é€çŸ­ä¿¡
            SMSUtils.sendMessage("å·¥å¤§å¤–å–å¥¶èŒ¶","SMS_279950017",phone,code);

            //éœ€è¦å°†ç”Ÿæˆçš„éªŒè¯ç ä¿å­˜åˆ°session
            session.setAttribute(phone,code);

            return R.success("æ‰‹æœºçŸ­ä¿¡éªŒè¯ç å‘é€æˆåŠŸ");
        }
        return R.error("æ‰‹æœºçŸ­ä¿¡éªŒè¯ç å‘é€å¤±è´¥");
    }
```

#### ç™»å½•æ ¡éªŒ

![](image/image_syNGiU4ucp.png)

```java
@PostMapping("/login")
    public R<User> login(@RequestBody Map map, HttpSession session){
        log.info(map.toString());

        //è·å–æ‰‹æœºå·
        String phone= map.get("phone").toString();

        //è·å–éªŒè¯ç 
        String code=map.get("code").toString();

        //ä»Sessionä¸­è·å–ä¿å­˜çš„éªŒè¯ç 
        Object codeInsession = session.getAttribute(phone);

        //è¿›è¡ŒéªŒè¯ç æ¯”å¯¹ï¼ˆé¡µé¢æäº¤çš„éªŒè¯ç å’ŒSessionä¸­ä¿å­˜çš„éªŒè¯ç æ¯”å¯¹ï¼‰
        if (codeInsession!=null&&codeInsession.equals(code)){
            //å¦‚æœæ¯”å¯¹æˆåŠŸï¼Œè¯´æ˜ç™»å½•æˆåŠŸ

            LambdaQueryWrapper<User> queryWrapper = new LambdaQueryWrapper<>();
            queryWrapper.eq(User::getPhone,phone);

            User user = userService.getOne(queryWrapper);
            if (user == null){
                //åˆ¤æ–­å½“å‰æ‰‹æœºå·å¯¹åº”çš„ç”¨æˆ·æ˜¯å¦ä¸ºæ–°ç”¨æˆ·ï¼Œå¦‚æœæ˜¯æ–°ç”¨æˆ·å°±è‡ªåŠ¨å®Œæˆæ³¨å†Œ
                user = new User();
                user.setPhone(phone);
                user.setStatus(1);
                userService.save(user);
            }
            session.setAttribute("user",user.getId());
            return R.success(user);
        }

        return R.error("ç™»é™†å¤±è´¥");
    }
```

## å¼€å‘Day6

### åŠŸèƒ½ï¼šå¯¼å…¥åœ°å€

![](image/image_-jhu72gu8t.png)

æ­æ¡†æ¶ï¼š ç•¥&#x20;

å…·ä½“ä»£ç åŠŸèƒ½å¼€å‘ï¼š

```java
/**
     * æ–°å¢
     */
    @PostMapping
    public R<AddressBook> save(@RequestBody AddressBook addressBook) {
        addressBook.setUserId(BaseContext.getCurrentId());
        log.info("addressBook:{}", addressBook);
        addressBookService.save(addressBook);
        return R.success(addressBook);
    }

    /**
     * è®¾ç½®é»˜è®¤åœ°å€
     */
    @PutMapping("default")
    public R<AddressBook> setDefault(@RequestBody AddressBook addressBook) {
        log.info("addressBook:{}", addressBook);
        LambdaUpdateWrapper<AddressBook> wrapper = new LambdaUpdateWrapper<>();
        wrapper.eq(AddressBook::getUserId, BaseContext.getCurrentId());
        wrapper.set(AddressBook::getIsDefault, 0);
        //SQL:update address_book set is_default = 0 where user_id = ?
        addressBookService.update(wrapper);

        addressBook.setIsDefault(1);
        //SQL:update address_book set is_default = 1 where id = ?
        addressBookService.updateById(addressBook);
        return R.success(addressBook);
    }

    /**
     * æ ¹æ®idæŸ¥è¯¢åœ°å€
     */
    @GetMapping("/{id}")
    public R get(@PathVariable Long id) {
        AddressBook addressBook = addressBookService.getById(id);
        if (addressBook != null) {
            return R.success(addressBook);
        } else {
            return R.error("æ²¡æœ‰æ‰¾åˆ°è¯¥å¯¹è±¡");
        }
    }

    /**
     * æŸ¥è¯¢é»˜è®¤åœ°å€
     */
    @GetMapping("default")
    public R<AddressBook> getDefault() {
        LambdaQueryWrapper<AddressBook> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.eq(AddressBook::getUserId, BaseContext.getCurrentId());
        queryWrapper.eq(AddressBook::getIsDefault, 1);

        //SQL:select * from address_book where user_id = ? and is_default = 1
        AddressBook addressBook = addressBookService.getOne(queryWrapper);

        if (null == addressBook) {
            return R.error("æ²¡æœ‰æ‰¾åˆ°è¯¥å¯¹è±¡");
        } else {
            return R.success(addressBook);
        }
    }

    /**
     * æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„å…¨éƒ¨åœ°å€
     */
    @GetMapping("/list")
    public R<List<AddressBook>> list(AddressBook addressBook) {
        addressBook.setUserId(BaseContext.getCurrentId());
        log.info("addressBook:{}", addressBook);

        //æ¡ä»¶æ„é€ å™¨
        LambdaQueryWrapper<AddressBook> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.eq(null != addressBook.getUserId(), AddressBook::getUserId, addressBook.getUserId());
        queryWrapper.orderByDesc(AddressBook::getUpdateTime);

        //SQL:select * from address_book where user_id = ? order by update_time desc
        return R.success(addressBookService.list(queryWrapper));
    }
```

#### ä½œä¸šï¼šè¡¥å……åŠŸèƒ½ï¼šä¿®æ”¹åœ°å€ ã€åˆ é™¤åœ°å€

```java
/**
     * @description è¡¥å……åŠŸèƒ½ï¼šä¿®æ”¹åœ°å€ä¿¡æ¯
     */
    @PutMapping
    public R<String> update(@RequestBody AddressBook addressBook){
        log.info("addressBook: {}",addressBook.toString());
        addressBookService.updateById(addressBook);
        return R.success("åœ°å€ä¿®æ”¹æˆåŠŸ");
    }

    /**
     * @description è¡¥å……åŠŸèƒ½ï¼šåˆ é™¤åœ°å€
     */
    @DeleteMapping
    public R<String> delete(@RequestParam Long ids){
        log.info("åˆ é™¤åœ°å€ï¼Œid= {}",ids);
        addressBookService.removeById(ids);
        return  R.success("åˆ é™¤åœ°å€æˆåŠŸ");
    }
```

### åŠŸèƒ½ï¼šèœå“å±•ç¤º

![](image/image_CaZsG-zels.png)

è¿™é‡Œå…¶å®å°±æ˜¯å¯¹ä¹‹å‰æ–¹æ³•çš„ä¸€äº›å®Œå–„æˆ–è¡¥å……ï¼š

```java

//å±•ç¤ºåˆ†ç±»ä¸‹çš„èœå“æ•°æ®
@GetMapping("/list")
    public R<List<DishDto>> list(Dish dish){
        //æ„é€ æŸ¥è¯¢æ¡ä»¶
        LambdaQueryWrapper<Dish> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.eq(dish.getCategoryId()!=null,Dish::getCategoryId, dish.getCategoryId());
        //åªæŸ¥åœ¨å”®çš„ï¼Œè¿‡æ»¤æ‰åœå”®çš„ï¼ˆçŠ¶æ€ä¸º0çš„ï¼‰
        queryWrapper.eq(Dish::getStatus,1);
        //æ·»åŠ æ’åºæ¡ä»¶
        queryWrapper.orderByAsc(Dish::getSort).orderByAsc(Dish::getUpdateTime);

        List<Dish> list = dishService.list(queryWrapper);

        List<DishDto> dishDtolist = list.stream().map((item) -> {
            DishDto dishDto = new DishDto();

            BeanUtils.copyProperties(item,dishDto);

            Long categoryId = item.getCategoryId();//åˆ†ç±»id
            //æ ¹æ®idæŸ¥è¯¢åˆ†ç±»å¯¹è±¡
            Category category = categoryService.getById(categoryId);

            if(category != null){
                String categoryName = category.getName();
                dishDto.setCategoryName(categoryName);
            }

            //å½“å‰èœå“çš„id
            Long dishId = item.getId();
            LambdaQueryWrapper<DishFlavor> lambdaQueryWrapper=new LambdaQueryWrapper<>();
            lambdaQueryWrapper.eq(DishFlavor::getDishId,dishId);
            //SQL:select * from dish_flavor where dish_id = ?
            List<DishFlavor> dishFlavorList = dishFlavorService.list(lambdaQueryWrapper);
            dishDto.setFlavors(dishFlavorList);
            return dishDto;
        }).collect(Collectors.toList());

        return R.success(dishDtolist);
    }
```

å±•ç¤ºå¥—é¤åˆ†ç±»ä¸‹çš„ å¥—é¤æ•°æ®

```java
/**
     * @description å±•ç¤ºå¥—é¤åˆ†ç±»ä¸‹çš„ å¥—é¤æ•°æ®
     * @author chaz
     * @date 16:12 2023/6/12
     * @param setmeal
     * @return com.chaz.reggie.common.R<java.util.List<com.chaz.reggie.entity.Setmeal>>
     */
    @GetMapping("/list")
    public R<List<Setmeal>> list(Setmeal setmeal){
        LambdaQueryWrapper<Setmeal> queryWrapper=new LambdaQueryWrapper<>();
        queryWrapper.eq(setmeal.getCategoryId()!=null,Setmeal::getCategoryId,setmeal.getCategoryId());
        queryWrapper.eq(setmeal.getStatus()!=null,Setmeal::getStatus,setmeal.getStatus());
        queryWrapper.orderByDesc(Setmeal::getUpdateTime);

        List<Setmeal> list = setmealService.list(queryWrapper);
        return R.success(list);
    }
```

&#x20;&#x20;

### åŠŸèƒ½ï¼šè´­ç‰©è½¦

![](image/image_J7YVaPjIW7.png)

æ¡†æ¶æ­å»ºã€‚ç•¥

![](image/image_6FeGeU-egN.png)

#### æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦

```java
@PostMapping("/add")
    public R<ShoppingCart> add(@RequestBody ShoppingCart shoppingCart){
        log.info("è´­ç‰©è½¦æ•°æ®:{}",shoppingCart);

        //è®¾ç½®ç”¨æˆ·idï¼ŒæŒ‡å®šå½“å‰æ˜¯å“ªä¸ªç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®
        Long currentId = BaseContext.getCurrentId();
        shoppingCart.setUserId(currentId);

        //æŸ¥è¯¢å½“å‰èœå“æ˜¯å¦å·²ç»åœ¨è´­ç‰©è½¦ä¸­
        Long dishId = shoppingCart.getDishId();

        LambdaQueryWrapper<ShoppingCart> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.eq(ShoppingCart::getUserId,currentId);

        if (dishId != null){
            //æ·»åŠ åˆ°è´­ç‰©è½¦çš„æ˜¯èœå“
            queryWrapper.eq(ShoppingCart::getDishId,dishId);
        }
        else{
            //æ·»åŠ åˆ°è´­ç‰©è½¦çš„æ˜¯å¥—é¤
            queryWrapper.eq(ShoppingCart::getSetmealId,shoppingCart.getSetmealId());
        }

        //SQL:select * from shopping_cart where user_id = ? and dish_id/setmeal_id = ?
        ShoppingCart cartServiceOne = shoppingCartService.getOne(queryWrapper);

        if (cartServiceOne!=null){
            //å¦‚æœå·²ç»å­˜åœ¨ï¼Œå°±åœ¨åŸæ¥æ•°é‡åŸºç¡€ä¸Š+1
            Integer number = cartServiceOne.getNumber();
            cartServiceOne.setNumber(number+1);
            shoppingCartService.updateById(cartServiceOne);
        }
        else {
            //å¦‚æœä¸å­˜åœ¨ï¼Œæ·»åŠ èœå“åˆ°è´­ç‰©è½¦ï¼Œæ•°é‡é»˜è®¤ä¸º1
            shoppingCart.setNumber(1);
            shoppingCartService.save(shoppingCart);
            cartServiceOne = shoppingCart;
        }
        return R.success(cartServiceOne);
    }
```

#### æŸ¥çœ‹/æ¸…ç©ºè´­ç‰©è½¦

éå¸¸ç®€å•

```java
 @GetMapping("/list")
    public R<List<ShoppingCart>> list(){
        log.info("æŸ¥çœ‹è´­ç‰©è½¦");
        LambdaQueryWrapper<ShoppingCart> queryWrapper=new LambdaQueryWrapper<>();
        queryWrapper.eq(ShoppingCart::getUserId,BaseContext.getCurrentId());
        queryWrapper.orderByAsc(ShoppingCart::getCreateTime);
        List<ShoppingCart> list = shoppingCartService.list(queryWrapper);
        return R.success(list);
    }
    
@DeleteMapping("/clean")
    public R<String> clean(){
        log.info("æ¸…ç©ºè´­ç‰©è½¦");
        //SQL:delete from shopping_cart where user_id = ?
        LambdaQueryWrapper<ShoppingCart> queryWrapper=new LambdaQueryWrapper<>();
        queryWrapper.eq(ShoppingCart::getUserId,BaseContext.getCurrentId());
        shoppingCartService.remove(queryWrapper);
        return R.success("å·²æ¸…ç©ºè´­ç‰©è½¦");
    }

```

#### ä½œä¸šï¼šè¡¥å……åŠŸèƒ½ï¼šå•†å“æ•°é‡-1

éœ€è¦æ³¨æ„-1ä¸º0çš„è¯ï¼Œç›´æ¥åˆ é™¤æœ¬æ¡

```java
@PostMapping("/sub")
    public R<ShoppingCart> sub(@RequestBody ShoppingCart shoppingCart){
        log.info("å¯¹åº”idçš„å•†å“æ•°é‡-1ï¼Œid = {}",shoppingCart.getDishId());
        LambdaQueryWrapper<ShoppingCart> queryWrapper=new LambdaQueryWrapper<>();
        //ç¡®å®šæ˜¯ èœå“ è¿˜æ˜¯å¥—é¤
        if (shoppingCart.getDishId()!=null){
            //å¦‚æœæ˜¯èœå“ï¼Œæ ¹æ®èœå“id æ‰¾åˆ°å¯¹åº”çš„æ•°æ®
            queryWrapper.eq(ShoppingCart::getDishId,shoppingCart.getDishId());
        }
        else {
            //å¦‚æœæ˜¯å¥—é¤ï¼Œæ ¹æ®å¥—é¤id æ‰¾æ•°æ®
            queryWrapper.eq(ShoppingCart::getSetmealId,shoppingCart.getSetmealId());
        }
        ShoppingCart cartServiceOne = shoppingCartService.getOne(queryWrapper);
        //æ‰¾åˆ°æ•°æ®åï¼Œåˆ¤æ–­æ•°é‡æ˜¯å¦==1
        if (cartServiceOne.getNumber()==1){
            //å¦‚æœ==1ï¼Œç›´æ¥åˆ é™¤æœ¬æ¡
            shoppingCartService.removeById(cartServiceOne);
        }
        else {
            //å¦åˆ™ï¼Œåœ¨è¯¥æ•°æ®åŸºç¡€ä¸Š-1 æ›´æ–°å³å¯ã€‚
            cartServiceOne.setNumber(cartServiceOne.getNumber()-1);
            shoppingCartService.updateById(cartServiceOne);
        }
        return R.success(cartServiceOne);
    }
```

### åŠŸèƒ½ï¼šç”¨æˆ·ä¸‹å•ï¼š

![](image/image_9-ErJ0GJt_.png)

1-3å‡åœ¨å‰è¾¹å·²ç»å®Œæˆï¼Œåªéœ€è¦å®Œæˆç¬¬4æ¡åŠŸèƒ½

![](image/image_53FFQgZxHq.png)

ç»å…¸æ­æ¶å­

![](image/image_JiqDvHr-kp.png)

æ­å®Œæ¡†æ¶å†™å…·ä½“ä»£ç ã€‚ï¼ˆç•¥ç¹çï¼‰

```java
Serviceå±‚ï¼š
    @Autowired
    private ShoppingCartService shoppingCartService;
    @Autowired
    private UserService userService;
    @Autowired
    private AddressBookService addressBookService;
    @Autowired
    private OrderDetailService orderDetailService;

    @Override
    public void submit(Orders orders) {
        //è·å¾—å½“å‰ç”¨æˆ·id
        Long userId= BaseContext.getCurrentId();

        //æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®
        LambdaQueryWrapper<ShoppingCart> queryWrapper=new LambdaQueryWrapper<>();
        queryWrapper.eq(ShoppingCart::getId,userId);
        List<ShoppingCart> shoppingCarts = shoppingCartService.list(queryWrapper);

        if (shoppingCarts==null||shoppingCarts.size()==0){
            throw new CustomException("è´­ç‰©è½¦ä¸ºç©ºï¼Œä¸èƒ½ä¸‹å•");
        }
        //æŸ¥è¯¢ç”¨æˆ·æ•°æ®
        User user = userService.getById(userId);
        //æŸ¥è¯¢åœ°å€æ•°æ®
        Long addressBookId = orders.getAddressBookId();
        AddressBook addressBook = addressBookService.getById(addressBookId);
        if (addressBook==null){
            throw new CustomException("åœ°å€æœ‰è¯¯ï¼Œä¸èƒ½ä¸‹å•");
        }
        
        long orderId = IdWorker.getId();//è®¢å•å·

        AtomicInteger amount = new AtomicInteger(0);//åŸå­æ“ä½œï¼Œå¤šçº¿ç¨‹æƒ…å†µä¸‹ä¿è¯çº¿ç¨‹å®‰å…¨

        List<OrderDetail> orderDetails =shoppingCarts.stream().map((item) ->{
            OrderDetail orderDetail = new OrderDetail();
            orderDetail.setOrderId(orderId);
            orderDetail.setNumber(item.getNumber());
            orderDetail.setDishFlavor(item.getDishFlavor());
            orderDetail.setDishId(item.getDishId());
            orderDetail.setSetmealId(item.getSetmealId());
            orderDetail.setName(item.getName());
            orderDetail.setImage(item.getImage());
            orderDetail.setAmount(item.getAmount());
            amount.addAndGet(item.getAmount().multiply(new BigDecimal(item.getNumber())).intValue());//ç´¯åŠ é‡‘é¢
            return orderDetail;
        }).collect(Collectors.toList());


        // å‘è®¢å•è¡¨æ’å…¥æ•°æ®ï¼Œä¸€æ¡æ•°æ®
        orders.setId(orderId);
        orders.setOrderTime(LocalDateTime.now());
        orders.setCheckoutTime(LocalDateTime.now());
        orders.setStatus(2);
        orders.setAmount(new BigDecimal(amount.get()));//æ€»é‡‘é¢
        orders.setUserId(userId);
        orders.setNumber(String.valueOf(orderId));
        orders.setUserName(user.getName());
        orders.setConsignee(addressBook.getConsignee());
        orders.setPhone(addressBook.getPhone());
        orders.setAddress((addressBook.getProvinceName() == null ? "" : addressBook.getProvinceName())
                + (addressBook.getCityName() == null ? "" : addressBook.getCityName())
                + (addressBook.getDistrictName() == null ? "" : addressBook.getDistrictName())
                + (addressBook.getDetail() == null ? "" : addressBook.getDetail()));
        //å‘è®¢å•è¡¨æ’å…¥æ•°æ®ï¼Œä¸€æ¡æ•°æ®
        this.save(orders);

        //å‘è®¢å•æ˜ç»†è¡¨æ’å…¥æ•°æ®ï¼Œå¤šæ¡æ•°æ®
        orderDetailService.saveBatch(orderDetails);

        //æ¸…ç©ºè´­ç‰©è½¦æ•°æ®ã€‚
        shoppingCartService.remove(queryWrapper);
    }
    
 Controllerå±‚ï¼š
    @PostMapping("/submit")
    public R<String> submit(@RequestBody Orders orders){
        log.info("è®¢å•æ•°æ®ï¼š{}",orders);
        orderService.submit(orders);
        return R.success("ä¸‹å•æˆåŠŸ");
    }
```

### å…·ä½“çŸ¥è¯†ç‚¹ï¼š

#### **Â· AtomicInteger ï¼š**

*AtomicInteger amount = new AtomicInteger(0);*//**åŸå­æ“ä½œï¼Œå¤šçº¿ç¨‹æƒ…å†µä¸‹ä¿è¯çº¿ç¨‹å®‰å…¨**

#### Â· **IdWorker**

idworker æ˜¯ä¸€ä¸ªåŸºäºzookeeperå’Œsnowflakeç®—æ³•çš„**åˆ†å¸ƒå¼ç»Ÿä¸€IDç”Ÿæˆå·¥å…·**ã€‚

é€šè¿‡zookeeperè‡ªåŠ¨æ³¨å†Œæœºå™¨ï¼ˆæœ€å¤š1024å°ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®šworkerIdå’ŒdataCenterIdã€‚
é€šè¿‡ZooKeeperæŒä¹…é¡ºåºèŠ‚ç‚¹ç‰¹æ€§ï¼Œæ¥é…ç½®ç»´æŠ¤èŠ‚ç‚¹çš„ç¼–å·NODEIDã€‚
é›†ç¾¤èŠ‚ç‚¹å‘½åæœåŠ¡çš„åŸºæœ¬æµç¨‹æ˜¯ï¼š
ï¼ˆ1ï¼‰å¯åŠ¨èŠ‚ç‚¹æœåŠ¡ï¼Œè¿æ¥ZooKeeperï¼Œ æ£€æŸ¥å‘½åæœåŠ¡æ ¹èŠ‚ç‚¹æ ¹èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»ºç³»ç»Ÿæ ¹èŠ‚ç‚¹ã€‚
ï¼ˆ2ï¼‰åœ¨æ ¹èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼Œå–å›é¡ºåºå·åšèŠ‚ç‚¹çš„NODEIDã€‚å¦‚ä½•ä¸´æ—¶èŠ‚ç‚¹å¤ªå¤šï¼Œå¯ä»¥æ ¹æ®éœ€è¦ï¼Œåˆ é™¤ä¸´æ—¶èŠ‚ç‚¹ã€‚

ç”±äºæ˜¯é‡‡ç”¨zookeeperé¡ºåºèŠ‚ç‚¹çš„ç‰¹æ€§ç”ŸæˆdatacenterIdå’ŒworkerIdï¼Œå¯ä»¥å¤©ç„¶çš„ä¿è¯datacenterIdå’ŒworkerIdçš„å”¯ä¸€æ€§ï¼Œå‡å°‘äº†äººå·¥ç»´æŠ¤çš„å¼Šç«¯ã€‚

#### Â· addAndGetï¼ˆï¼‰

åˆ†æå…¶ä¸­çš„addAndGetæ–¹æ³•ï¼Œå…¶æºç å¦‚ä¸‹

```java
public final int addAndGet(int delta) {
  return unsafe.getAndAddInt(this, valueOffset, delta) + delta;
}
```

å‘ç°å®ƒæ˜¯è°ƒç”¨unsafeåŒ…çš„æ–¹æ³•ï¼Œé¦–å…ˆå¯¹ä¼ ç»™unsafeçš„getAnddAddIntçš„å‚æ•°è¿›è¡Œè¯´æ˜ï¼š

-   thisæŒ‡å½“å‰çš„AtomicIntegerå¯¹è±¡
-   valueOffsetç”±AtmoicIntegerç±»ä¸­çš„é™æ€ä»£ç å—ç¡®å®šï¼ŒæŒ‡çš„æ˜¯AtomicIntegerçš„valueå±æ€§åœ¨å†…å­˜ä¸­çš„åç§»é‡
-   deltaå³è¦valueå€¼è¦æ”¹å˜çš„å¤§å°

#### Â· **saveBatch**ï¼ˆï¼‰

```java
// æ’å…¥ä¸€æ¡è®°å½•ï¼ˆé€‰æ‹©å­—æ®µï¼Œç­–ç•¥æ’å…¥ï¼‰
boolean save(T entity);
// æ’å…¥ï¼ˆæ‰¹é‡ï¼‰
boolean saveBatch(Collection<T> entityList);
// æ’å…¥ï¼ˆæ‰¹é‡ï¼‰
boolean saveBatch(Collection<T> entityList, int batchSize);//batchSizeæ’å…¥æ‰¹æ¬¡æ•°é‡
```
